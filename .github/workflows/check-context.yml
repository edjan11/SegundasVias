name: 'PR Context Size Check'

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  check-context:
    name: Check context files size
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Install dependencies
        run: npm ci

      - name: Run context size check
        id: contextcheck
        run: npm run check:context
        continue-on-error: true

      - name: Comment on PR if context too large
        if: steps.contextcheck.conclusion == 'failure'
        uses: actions/github-script@v6
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const pr = context.payload.pull_request;
            const body = `⚠️ O verificador de contextos detectou que um dos arquivos em 
`.github/*context*.md` excedeu o limite configurado. Por favor, **divida** o contexto em fragmentos e atualize o índice em 
`.github/FRONTEND-CARTORIO-CONTEXT.md` ou `.github/BACKEND-CARTORIO-CONTEXT.md`.

Sugestões:
- Criar arquivos como `FRONTEND-CARTORIO-UI.md`, `FRONTEND-CARTORIO-TESTS.md`.
- Arquivar conteúdo obsoleto em `.github/archive/` com nota.

Se quiser, poso abrir uma issue propondo a fragmentação e atribuir partes. (Auto check: `npm run check:context`).`;
            await github.rest.issues.createComment({owner: context.repo.owner, repo: context.repo.repo, issue_number: pr.number, body});