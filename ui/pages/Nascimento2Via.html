<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Certidao de Nascimento (TJ)</title>
  <link rel="stylesheet" href="../styles/base.css" />
  <link rel="stylesheet" href="../styles/layout.css" />
  <link rel="stylesheet" href="../styles/components.css" />
</head>
<body class="page-nascimento">
  <script>
    // Redirect to Base2ViaLayout to ensure single, consistent initialization
    (function() {
      if (!location.pathname.endsWith('Base2ViaLayout.html')) {
        const url = new URL('/ui/pages/Base2ViaLayout.html', location.origin);
        url.searchParams.set('act', 'nascimento');
        location.replace(url);
      }
    })();
  </script>
  <div class="app-shell">
    <div class="main-pane">
      <div class="container">
    <div class="toolbar">
      <div class="toolbar-left">
        <div class="app-title">2ª Via de Certidão</div>
        <div class="ato-picker">
          <label class="label" for="ato-select">Ato</label>
          <select id="ato-select" class="ato-select">
            <option value="nascimento">Nascimento</option>
            <option value="casamento">Casamento</option>
            <option value="obito">Obito</option>
          </select>
        </div>
      </div>
      <div class="toolbar-right">
        <button id="drawer-toggle" class="btn secondary">Painel</button>
        <div style="display:inline-flex; gap:6px; align-items:center; margin-left:8px;">
          <button id="btn-json" class="btn json compact" title="Gerar JSON">JSON</button>
          <button id="btn-xml" class="btn xml compact" title="Exportar XML">XML</button>
          <button id="btn-print" class="btn pdf compact" title="Imprimir PDF">PDF</button>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="cardTitle">Registro</div>

      <div class="section">
        <div class="row">
          <div class="field">
            <label>Data de registro <span class="req">*</span></label>
          <input
            id="data-reg"
            data-bind="registro.data_registro"
            type="text"
            placeholder="00/00/0000"
            inputmode="tel"
            maxlength="10"
            autocomplete="off"
            pattern="\\d{2}/\\d{2}/\\d{4}"
            class="w-date"
            data-required
          />
          </div>

          <div class="field">
            <label>Data de nascimento</label>
            <div class="field-line">
              <input
                id="dn"
                data-bind="registro.data_nascimento"
                type="text"
                placeholder="00/00/0000"
                inputmode="tel"
                maxlength="10"
                autocomplete="off"
                pattern="\\d{2}/\\d{2}/\\d{4}"
                class="w-date"
              />
              <label class="inline-check inline-check--compact ignore-toggle" for="dn-ign">
                <input type="checkbox" data-bind="registro.data_nascimento_ignorada" id="dn-ign" />
                <span>Ignorar</span>
              </label>
            </div>
          </div>

          <div class="field">
            <label>Hora do nascimento</label>
            <div class="field-line">
              <input
                id="hn"
                data-bind="registro.hora_nascimento"
                type="text"
                placeholder="00:00"
                inputmode="tel"
                maxlength="5"
                autocomplete="off"
                pattern="([01]\\d|2[0-3]):[0-5]\\d"
                class="w-time"
              />
              <label class="inline-check inline-check--compact ignore-toggle" for="hn-ign">
                <input type="checkbox" data-bind="registro.hora_nascimento_ignorada" id="hn-ign" />
                <span>Ignorar</span>
              </label>
            </div>
          </div>

          <div class="field">
            <label>DNV</label>
            <input data-bind="registro.numero_dnv" class="w-num" placeholder="DNV" />
          </div>
        </div>
      </div>

      <div class="section-divider"></div>

      <div class="section">
        <div class="row row--fixed-2">
          <div class="field grow name-field">
          <label class="label-row">
            <span>Nome completo <span class="req">*</span></span>

            <label class="name-suggest" title="Adicionar nome ao banco" data-tooltip="Adicionar nome ao banco (quando estiver correto)">
              <input type="checkbox" class="name-suggest-check" aria-label="Adicionar nome ao banco" />
              <span class="name-suggest-label">Adicionar ao banco</span>
            </label>
          </label>

          <input data-bind="registro.nome_completo" data-required data-name-validate />

          <!-- hint (só aparece quando suspeito) -->
          <div class="hint"><span class="icon" aria-hidden="true">⚠</span><span class="hint-text">Nome incorreto!</span></div>
        </div>


          <div class="field" style="width: 160px;">
            <label>Sexo <span class="req">*</span></label>
            <select data-bind="registro.sexo" id="sexo" class="w-sexo" data-required>
              <option></option>
              <option>masculino</option>
              <option>feminino</option>
              <option>ignorado</option>
              <option>outros</option>
            </select>
          </div>

          <div class="field" id="sexo-outros-wrap" style="width: 180px;">
            <label>Sexo (outros) <span class="req">*</span></label>
            <input data-bind="registro.sexo_outros" id="sexo-outros" placeholder="Descreva" />
          </div>
        </div>
      </div>

      <div class="section-divider"></div>

      <div class="section">
        <div class="row row-place">
          <div class="field grow" style="min-width: 400px;">
            <label>Descricao do local de nascimento <span class="req">*</span></label>
            <input
              id="local-nascimento"
              data-bind="registro.local_nascimento"
              data-required
              placeholder="Ex: Na Clinica Santa Helena, Aracaju/SE"
              autocomplete="off"
            />
            <div id="local-suggestion" class="suggestion-bar">
              <span id="local-suggestion-text" class="suggestion-text"></span>
              <button type="button" class="btn secondary tiny" id="local-suggestion-apply">Aplicar sugestao</button>
            </div>
          </div>
          <div class="field" style="width: 120px;">
            <label>Local</label>
            <select name="localNascimento" data-bind="ui.local_nascimento_tipo" id="localNascimento">
              <option value="O" selected>OUTROS</option>
              <option value="H">HOSPITAL</option>
              <option value="S">OUTROS ESTABELECIMENTOS DE SAUDE SEM INTERNACAO</option>
              <option value="D">DOMICILIO</option>
              <option value="V">VIA PUBLICA</option>
              <option value="I">IGNORADO</option>
            </select>
          </div>
        </div>

        <div class="row row-place">
          <div class="field grow">
            <label><span id="label-municipio-principal">Municipio (nascimento e naturalidade)</span> <span class="req">*</span></label>
            <input data-bind="registro.municipio_nascimento" data-required placeholder="Cidade" />
          </div>

          <div class="field" style="width: 130px;">
            <label><span id="label-uf-principal">UF </span> <span class="req">*</span></label>
            <select data-bind="registro.uf_nascimento" data-required class="w-uf">
              <option></option>
              <option>IG</option>
          <option>AC</option><option>AL</option><option>AP</option><option>AM</option><option>BA</option><option>CE</option><option>DF</option><option>ES</option><option>GO</option><option>MA</option><option>MT</option><option>MS</option><option>MG</option><option>PA</option><option>PB</option><option>PR</option><option>PE</option><option>PI</option><option>RJ</option><option>RN</option><option>RS</option><option>RO</option><option>RR</option><option>SC</option><option>SP</option><option>SE</option><option>TO</option>
            </select>
          </div>

          <div class="field checkboxField nat-toggle">
            <input type="checkbox" data-bind="ui.naturalidade_diferente" id="naturalidade-diferente" />
            <label for="naturalidade-diferente">Naturalidade diferente do nascimento</label>
          </div>
        </div>

        <div class="row naturalidade-extra" id="naturalidade-extra">
          <div class="field" style="width: 260px;">
            <label class="label-row">
              <span>Municipio de naturalidade</span>
              <button type="button" class="link-btn" id="copy-naturalidade">Copiar nascimento</button>
            </label>
            <input data-bind="registro.municipio_naturalidade" placeholder="Cidade" />
          </div>

          <div class="field" style="width: 180px;">
            <label>UF de naturalidade</label>
            <select data-bind="registro.uf_naturalidade" class="w-uf">
              <option></option>
              <option>IG</option>
          <option>AC</option><option>AL</option><option>AP</option><option>AM</option><option>BA</option><option>CE</option><option>DF</option><option>ES</option><option>GO</option><option>MA</option><option>MT</option><option>MS</option><option>MG</option><option>PA</option><option>PB</option><option>PR</option><option>PE</option><option>PI</option><option>RJ</option><option>RN</option><option>RS</option><option>RO</option><option>RR</option><option>SC</option><option>SP</option><option>SE</option><option>TO</option>
            </select>
          </div>
        </div>
      </div>

      <div class="section-divider"></div>

      <div class="section">
        <div class="filiacao-grid">
          <div class="field">
            <label>Nome da mãe</label>
            <input data-bind="ui.mae_nome" data-name-validate />
          </div>

          <div class="field">
            <label>Cidade</label>
            <input data-bind="ui.mae_cidade" />
          </div>

          <div class="field">
            <label>UF</label>
            <select data-bind="ui.mae_uf" class="w-uf">
              <option></option>
              <option>IG</option>
          <option>AC</option><option>AL</option><option>AP</option><option>AM</option><option>BA</option><option>CE</option><option>DF</option><option>ES</option><option>GO</option><option>MA</option><option>MT</option><option>MS</option><option>MG</option><option>PA</option><option>PB</option><option>PR</option><option>PE</option><option>PI</option><option>RJ</option><option>RN</option><option>RS</option><option>RO</option><option>RR</option><option>SC</option><option>SP</option><option>SE</option><option>TO</option>
            </select>
          </div>
        </div>

        <div class="filiacao-avos">
          <div class="field">
            <label>Avó materna</label>
            <input data-bind="ui.mae_avo_materna" />
          </div>
          <div class="field">
            <label>Avô materno</label>
            <input data-bind="ui.mae_avo_materno" />
          </div>
        </div>

        <div class="filiacao-split"></div>

        <div class="filiacao-grid">
          <div class="field">
            <label>Nome do pai</label>
            <input data-bind="ui.pai_nome" data-name-validate />
          </div>

          <div class="field">
            <label>Cidade</label>
            <input data-bind="ui.pai_cidade" />
          </div>

          <div class="field">
            <label>UF</label>
            <select data-bind="ui.pai_uf" class="w-uf">
              <option></option>
              <option>IG</option>
          <option>AC</option><option>AL</option><option>AP</option><option>AM</option><option>BA</option><option>CE</option><option>DF</option><option>ES</option><option>GO</option><option>MA</option><option>MT</option><option>MS</option><option>MG</option><option>PA</option><option>PB</option><option>PR</option><option>PE</option><option>PI</option><option>RJ</option><option>RN</option><option>RS</option><option>RO</option><option>RR</option><option>SC</option><option>SP</option><option>SE</option><option>TO</option>
            </select>
          </div>
        </div>

        <div class="filiacao-avos">
          <div class="field">
            <label>Avó paterna</label>
            <input data-bind="ui.pai_avo_paterna" />
          </div>
          <div class="field">
            <label>Avô paterno</label>
            <input data-bind="ui.pai_avo_paterno" />
          </div>
        </div>
      </div>

      <div class="section-divider"></div>

      <details class="collapse">
        <summary>Outros genitores</summary>
        <div class="subcard">
          <div class="subTitle">3º Genitor</div>
          <div class="filiacao-grid">
            <div class="field">
              <label>Nome</label>
              <input data-bind="ui.genitor3_nome" data-name-validate />
            </div>
            <div class="field">
              <label>Cidade de nascimento</label>
              <input data-bind="ui.genitor3_cidade" />
            </div>
            <div class="field">
              <label>UF</label>
              <select data-bind="ui.genitor3_uf" class="w-uf">
                <option></option>
                <option>IG</option>
                <option>AC</option><option>AL</option><option>AP</option><option>AM</option><option>BA</option><option>CE</option><option>DF</option><option>ES</option><option>GO</option><option>MA</option><option>MT</option><option>MS</option><option>MG</option><option>PA</option><option>PB</option><option>PR</option><option>PE</option><option>PI</option><option>RJ</option><option>RN</option><option>RS</option><option>RO</option><option>RR</option><option>SC</option><option>SP</option><option>SE</option><option>TO</option>
              </select>
            </div>
          </div>
          <div class="filiacao-avos">
            <div class="field">
              <label>Nome da mãe</label>
              <input data-bind="ui.genitor3_avo1" data-name-validate />
            </div>
            <div class="field">
              <label>Nome do pai</label>
              <input data-bind="ui.genitor3_avo2" data-name-validate />
            </div>
          </div>

          <div class="filiacao-split"></div>

          <div class="subTitle">4º Genitor</div>
          <div class="filiacao-grid">
            <div class="field">
              <label>Nome</label>
              <input data-bind="ui.genitor4_nome" data-name-validate />
            </div>
            <div class="field">
              <label>Cidade de nascimento</label>
              <input data-bind="ui.genitor4_cidade" />
            </div>
            <div class="field">
              <label>UF</label>
              <select data-bind="ui.genitor4_uf" class="w-uf">
                <option></option>
                <option>IG</option>
                <option>AC</option><option>AL</option><option>AP</option><option>AM</option><option>BA</option><option>CE</option><option>DF</option><option>ES</option><option>GO</option><option>MA</option><option>MT</option><option>MS</option><option>MG</option><option>PA</option><option>PB</option><option>PR</option><option>PE</option><option>PI</option><option>RJ</option><option>RN</option><option>RS</option><option>RO</option><option>RR</option><option>SC</option><option>SP</option><option>SE</option><option>TO</option>
              </select>
            </div>
          </div>
          <div class="filiacao-avos">
            <div class="field">
              <label>Nome da mãe</label>
              <input data-bind="ui.genitor4_avo1" data-name-validate />
            </div>
            <div class="field">
              <label>Nome do pai</label>
              <input data-bind="ui.genitor4_avo2" data-name-validate />
            </div>
          </div>
        </div>
      </details>

      <div class="section-divider"></div>

      <div class="section">
        <div class="row">
          <div class="field grow">
            <label>Averbação / Anotação</label>
            <textarea data-bind="registro.averbacao_anotacao"></textarea>
          </div>
        </div>
      </div>

      <div class="section-divider"></div>

      <div class="section">
        <div class="row row--registro">
          <div class="field">
            <label>Cartório (ofício)</label>
            <select data-bind="ui.cartorio_oficio" id="cartorio-oficio" class="w-cartorio">
              <option></option>
              <option value="6">6</option>
              <option value="9">9</option>
              <option value="12">12</option>
              <option value="13">13</option>
              <option value="14">14</option>
              <option value="15">15</option>
            </select>
          </div>

          <div class="field">
            <label>Livro</label>
            <input data-bind="ui.matricula_livro" id="matricula-livro" class="w-livro" placeholder="00000" inputmode="numeric" maxlength="5" />
          </div>

          <div class="field">
            <label>Folha</label>
            <input data-bind="ui.matricula_folha" id="matricula-folha" class="w-folha" placeholder="000" inputmode="numeric" maxlength="3" />
          </div>

          <div class="field">
            <label>Termo</label>
            <input data-bind="ui.matricula_termo" id="matricula-termo" class="w-termo" placeholder="0000000" inputmode="numeric" maxlength="7" />
          </div>

          <div class="field">
            <label>Matricula (gerada)</label>
            <input data-bind="registro.matricula" id="matricula" class="w-matricula" readonly />
          </div>

          <div class="field" id="casamento-tipo-wrap" style="display:none;">
            <label>Casamento</label>
            <select data-bind="ui.casamento_tipo" id="casamento-tipo" class="w-cartorio">
              <option></option>
              <option value="2">Civil</option>
              <option value="3">Religioso</option>
            </select>
          </div>
        </div>

        <div class="row row--cpf" style="opacity:0.9;">
          <div class="field">
            <label>CPF</label>
            <div class="field-line">
              <input data-bind="registro.cpf" id="cpf" placeholder="000.000.000-00" class="w-cpf" inputmode="numeric" maxlength="14" />
              <label class="inline-check inline-check--compact cpf-toggle" for="cpf-sem">
                <input type="checkbox" data-bind="registro.cpf_sem_inscricao" id="cpf-sem" />
                <span>Não inscrito</span>
              </label>
            </div>
          </div>
          <div class="field">
            <label>Assinante</label>
            <select name="idAssinante" data-signer-select></select>
          </div>
        </div>
      </div>

      <div class="section-divider"></div>

      <details class="collapse">
        <summary>Avancado</summary>

        <div class="subcard">
          <div class="subTitle">Gemeos</div>
          <div class="grid">
            <div class="field span-3">
              <label>quantidade</label>
              <input data-bind="registro.gemeos.quantidade" />
            </div>
            <div class="field span-9">
              <label>irmao (nome|matricula ou nome - matricula por linha)</label>
              <textarea data-bind="ui.gemeos_irmao_raw" placeholder="Ex.: JOÃO - 123456"></textarea>
            </div>
          </div>
        </div>

        <div class="subcard">
          <div class="subTitle">Anotacoes cadastro (1 por linha)</div>
          <div class="field">
            <label>tipo|documento|orgao_emissor|uf_emissao|data_emissao</label>
            <textarea data-bind="ui.anotacoes_raw"></textarea>
          </div>
        </div>
      </details>

      </div>
    </div>

    <div class="ops-pane" id="ops-pane" aria-hidden="true">
      <div class="ops-header">
        <div class="ops-title">Operacoes</div>
        <button class="btn tiny secondary ops-close" type="button">Fechar</button>
      </div>
      <div class="ops-body">
        <div id="op-search" class="ops-panel">
          <div class="card">
            <div class="cardTitle">Busca</div>
            <div class="grid search-grid">
              <div class="field span-12">
                <label>Tipo</label>
                <div class="segmented">
                  <button type="button" class="seg-btn active" data-kind-toggle data-kind="">Todos</button>
                  <button type="button" class="seg-btn" data-kind-toggle data-kind="nascimento">Nascimento</button>
                  <button type="button" class="seg-btn" data-kind-toggle data-kind="casamento">Casamento</button>
                  <button type="button" class="seg-btn" data-kind-toggle data-kind="obito">Obito</button>
                </div>
                <input type="hidden" id="search-kind" value="" />
              </div>
              <div class="field span-12">
                <label>Busca livre</label>
                <input id="search-q" placeholder="Nome, CPF, matricula, municipio..." />
              </div>
              <div class="field span-6">
                <label>Nome</label>
                <input id="search-nome" />
              </div>
              <div class="field span-6">
                <label>Nome da mae</label>
                <input id="search-mae" />
              </div>
              <div class="field span-4">
                <label>CPF</label>
                <input id="search-cpf" inputmode="numeric" />
              </div>
              <div class="field span-4">
                <label>Termo</label>
                <input id="search-termo" inputmode="numeric" />
              </div>
            </div>
            <div class="toolbar-left" style="margin-top: 10px;">
              <button id="btn-search" class="btn secondary" type="button">Buscar</button>
            </div>
          </div>
          <div id="search-results" class="search-results"></div>
        </div>

        <div id="op-actions" class="ops-panel">
          <div class="card">
            <div class="cardTitle">Acoes</div>
            <div class="action-status">
              <div class="action-row">
                <span class="label">JSON em memoria</span>
                <span id="status-json" class="badge">—</span>
              </div>
              <div class="action-row">
                <span class="label">XML gerado</span>
                <span id="status-xml" class="badge">—</span>
              </div>
              <div class="action-row">
                <span class="label">PostgreSQL</span>
                <span id="status-db" class="badge">NAO</span>
              </div>
            </div>
            <div class="toolbar-left" style="margin-top: 10px;">
              <button id="actions-save" class="btn save" type="button">Salvar</button>
              <button id="actions-export-json" class="btn secondary" type="button">Exportar JSON</button>
              <button id="actions-export-xml" class="btn secondary" type="button">Baixar XML</button>
              <button id="actions-export-pdf" class="btn secondary" type="button">PDF</button>
            </div>
            <div class="action-hints">
              <span class="badge">Ctrl+Espaco: JSON</span>
              <span class="badge">Ctrl+Alt+P: PDF</span>
            </div>
            <div id="actions-status" class="import-status"></div>
          </div>
        </div>
      </div>
    </div>

  </div>

    <div id="drawer-slot"></div>

  <script type="module" src="../js/nascimento.bundle.js"></script>
  <script>
    (function(){
      try{
        const sel = document.getElementById('ato-select');
        if (!sel) return;
        sel.addEventListener('change', ()=>{
          try{
            const map = { nascimento: './Nascimento2Via.html', casamento: './Casamento2Via.html', obito: './Obito2Via.html' };
            const next = map[sel.value];
            if (next) {
              // dispatch app navigation event for smoother behavior
              window.dispatchEvent(new CustomEvent('app:navigate', { detail: { href: next } }));
            }
          }catch(e){}
        });
      }catch(e){}
    })();
  </script>
</body>
</html>

