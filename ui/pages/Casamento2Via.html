<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>2 via casamento</title>
  <link rel="stylesheet" href="../styles/base.css" />
  <link rel="stylesheet" href="../styles/layout.css" />
  <link rel="stylesheet" href="../styles/components.css" />
</head>
<body class="page-casamento">
  <script>
    // Redirect to Base2ViaLayout to ensure single, consistent initialization
    (function() {
      if (!location.pathname.endsWith('Base2ViaLayout.html')) {
        const url = new URL('/ui/pages/Base2ViaLayout.html', location.origin);
        url.searchParams.set('act', 'casamento');
        location.replace(url);
      }
    })();
  </script>
  <div class="app-shell">
    <div class="main-pane">
      <div class="container">
    <form id="form-casamento">
      <!-- Anti-autofill honeypot (consumes browser autofill) -->
      <div class="no-autofill-honeypot" aria-hidden="true">
        <input autocomplete="username" name="no_autofill_username" tabindex="-1" />
        <input type="password" autocomplete="new-password" name="no_autofill_password" tabindex="-1" />
        <input autocomplete="address-line1" name="no_autofill_addr1" tabindex="-1" />
        <input autocomplete="address-line2" name="no_autofill_addr2" tabindex="-1" />
        <input autocomplete="postal-code" name="no_autofill_postal" tabindex="-1" />
        <input autocomplete="country" name="no_autofill_country" tabindex="-1" />
      </div>
      
      <!-- Hidden field for certidao.tipo_registro (required by import payload validation) -->
      <input type="hidden" data-bind="certidao.tipo_registro" value="casamento" />
      
      <div class="card">
        <div class="section">
        <div class="subTitulo">Termo e casamento</div>
        <div class="grid grid-matricula">
          <div class="campo span-3">
            <label class="label">Data do termo <span class="obrigatorio">*</span></label>
            <input data-bind="registro.data_registro" name="dataTermo" placeholder="DD/MM/AAAA" inputmode="tel" maxlength="10" autocomplete="off" data-date data-required />
          </div>
          <div class="campo span-3">
            <label class="label">Data do casamento <span class="obrigatorio">*</span></label>
            <input name="dataCasamento" placeholder="DD/MM/AAAA" inputmode="tel" maxlength="10" autocomplete="off" data-date data-required />
          </div>
          <div class="campo span-3">
            <label class="label">Tipo de casamento <span class="obrigatorio">*</span></label>
            <select data-bind="ui.casamento_tipo" name="tipoCasamento" id="casamento-tipo-select" data-required>
              <option value=""></option>
              <option value="2">Civil</option>
              <option value="3">Religioso</option>
            </select>
          </div>
          <div class="campo span-3">
            <label class="label">Regime de bens</label>
            <select name="regimeBens">
              <option value=""></option>
              <option value="L">Separacao legal de bens</option>
              <option value="C">Separacao convencional de bens</option>
              <option value="B">Comunhao de bens</option>
              <option value="P">Comunhao parcial de bens</option>
              <option value="U">Comunhao universal de bens</option>
              <option value="A">Participacao final de bens nos aquestos</option>
              <option value="I">Ignorado</option>
            </select>
          </div>
          <!-- Livro/Folha/Termo moved to lower section under 2o nubente per layout request -->
        </div>
      </div>
      <div class="section-divider"></div>

      <div class="section">
        <div class="subTitulo">Nomes dos Cônjuges</div>
        <div class="grid">
          <!-- Cônjuge 1 (Noivo) -->
          <div class="campo span-12">
            <div class="label" style="font-weight: 600; margin-bottom: 8px;">1º Cônjuge (Noivo)</div>
          </div>
          <div class="campo span-4">
            <label class="label">Nome anterior ao casamento <span class="obrigatorio">*</span></label>
            <input name="nomeAntesCasamentoNoivo" data-name-validate data-required />
          </div>
          <div class="campo span-4">
            <label class="label">Nome que passou a utilizar após o casamento</label>
            <input name="nomeAposCasamentoNoivo" data-name-validate />
          </div>
          <div class="campo span-4">
            <label class="label">Nome atual (após alterações posteriores)</label>
            <input name="nomeAtualNoivo" data-name-validate />
          </div>
          
          <!-- Cônjuge 2 (Noiva) -->
          <div class="campo span-12">
            <div class="label" style="font-weight: 600; margin-bottom: 8px; margin-top: 16px;">2º Cônjuge (Noiva)</div>
          </div>
          <div class="campo span-4">
            <label class="label">Nome anterior ao casamento <span class="obrigatorio">*</span></label>
            <input name="nomeAntesCasamentoNoiva" data-name-validate data-required />
          </div>
          <div class="campo span-4">
            <label class="label">Nome que passou a utilizar após o casamento</label>
            <input name="nomeAposCasamentoNoiva" data-name-validate />
          </div>
          <div class="campo span-4">
            <label class="label">Nome atual (após alterações posteriores)</label>
            <input name="nomeAtualNoiva" data-name-validate />
          </div>
        </div>
      </div>
      <div class="section-divider"></div>

      <div class="section">
        <div class="subTitulo">1o nubente (noivo) - Dados Complementares</div>
        <div class="grid">
          <div class="campo span-6">
            <label class="label">Nome do pai</label>
            <input name="nomePaiNoivo" data-name-validate />
          </div>
          <div class="campo span-6">
            <label class="label">Nome da mae</label>
            <input name="nomeMaeNoivo" data-name-validate />
          </div>
          <div class="campo span-3">
            <label class="label">Data de nascimento</label>
            <input name="dataNascimentoNoivo" placeholder="DD/MM/AAAA" inputmode="tel" maxlength="10" autocomplete="off" data-date />
          </div>
          <div class="campo span-6">
            <label class="label">Cidade nascimento</label>
            <input name="cidadeNascimentoNoivo" autocomplete="nope" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </div>
          <div class="campo span-3">
            <label class="label">UF nascimento</label>
            <select name="ufNascimentoNoivo" autocomplete="nope" spellcheck="false">
              <option value=""></option>
              <option>AC</option><option>AL</option><option>AP</option><option>AM</option><option>BA</option>
              <option>BR</option><option>CE</option><option>DF</option><option>ES</option><option>ET</option>
              <option>GO</option><option>IG</option><option>MA</option><option>MT</option><option>MS</option>
              <option>MG</option><option>PA</option><option>PB</option><option>PR</option><option>PE</option>
              <option>PI</option><option>RJ</option><option>RN</option><option>RS</option><option>RO</option>
              <option>RR</option><option>SC</option><option>SP</option><option>SE</option><option>TO</option>
            </select>
          </div>
          <div class="campo span-3">
            <label class="label">Nacionalidade</label>
            <input name="nacionalidadeNoivo" />
          </div>
          <div class="campo span-3">
            <label class="label">Estado civil</label>
            <select name="estadoCivilNoivo">
              <option value=""></option>
              <option value="SO">Solteiro(a)</option>
              <option value="CA">Casado(a)</option>
              <option value="DI">Divorciado(a)</option>
              <option value="VI">Viuvo(a)</option>
              <option value="SJ">Separado(a) judicialmente</option>
              <option value="DE">Desquitado(a)</option>
              <option value="IG">Ignorado</option>
            </select>
          </div>
          <div class="campo span-3">
            <label class="label">CPF</label>
            <div class="field-line">
              <input data-bind="registro.cpf_noivo" name="CPFNoivo" placeholder="000.000.000-00" inputmode="numeric" maxlength="14" autocomplete="off" data-cpf class="w-cpf" />
              <label class="inline-check inline-check--stack" for="cpf-noivo-ign">
                <span>Ignorar</span>
                <input type="checkbox" id="cpf-noivo-ign" />
              </label>
            </div>
          </div>
        </div>
      </div>
      <div class="section-divider"></div>

      <div class="section">
        <div class="subTitulo">2o nubente (noiva) - Dados Complementares</div>
        <div class="grid">
          <div class="campo span-6">
            <label class="label">Nome do pai</label>
            <input name="nomePaiNoiva" data-name-validate />
          </div>
          <div class="campo span-6">
            <label class="label">Nome da mae</label>
            <input name="nomeMaeNoiva" data-name-validate />
          </div>
          <div class="campo span-3">
            <label class="label">Data de nascimento</label>
            <input name="dataNascimentoNoiva" placeholder="DD/MM/AAAA" inputmode="tel" maxlength="10" autocomplete="off" data-date />
          </div>
          <div class="campo span-6">
            <label class="label">Cidade nascimento</label>
            <input name="cidadeNascimentoNoiva" autocomplete="nope" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </div>
          <div class="campo span-3">
            <label class="label">UF nascimento</label>
            <select name="ufNascimentoNoiva" autocomplete="nope" spellcheck="false">
              <option value=""></option>
              <option>AC</option><option>AL</option><option>AP</option><option>AM</option><option>BA</option>
              <option>BR</option><option>CE</option><option>DF</option><option>ES</option><option>ET</option>
              <option>GO</option><option>IG</option><option>MA</option><option>MT</option><option>MS</option>
              <option>MG</option><option>PA</option><option>PB</option><option>PR</option><option>PE</option>
              <option>PI</option><option>RJ</option><option>RN</option><option>RS</option><option>RO</option>
              <option>RR</option><option>SC</option><option>SP</option><option>SE</option><option>TO</option>
            </select>
          </div>
          <div class="campo span-3">
            <label class="label">Nacionalidade</label>
            <input name="nacionalidadeNoiva" />
          </div>
          <div class="campo span-3">
            <label class="label">Estado civil</label>
            <select name="estadoCivilNoiva">
              <option value=""></option>
              <option value="SO">Solteiro(a)</option>
              <option value="CA">Casado(a)</option>
              <option value="DI">Divorciado(a)</option>
              <option value="VI">Viuvo(a)</option>
              <option value="SJ">Separado(a) judicialmente</option>
              <option value="DE">Desquitado(a)</option>
              <option value="IG">Ignorado</option>
            </select>
          </div>
          <div class="campo span-3">
            <label class="label">CPF</label>
            <div class="field-line">
              <input data-bind="registro.cpf_noiva" name="CPFNoiva" placeholder="000.000.000-00" inputmode="numeric" maxlength="14" autocomplete="off" data-cpf class="w-cpf" />
              <label class="inline-check inline-check--stack" for="cpf-noiva-ign">
                <span>Ignorar</span>
                <input type="checkbox" id="cpf-noiva-ign" />
              </label>
            </div>
          </div>
        </div>
      </div>
      <div class="section-divider"></div>

      <div class="section">
        <div class="subTitulo">Observacoes</div>
        <div class="campo">
          <label class="label">Observacao</label>
          <textarea name="observacao" rows="4"></textarea>
        </div>
      </div>
      <div class="section-divider"></div>
      <div class="section">
        <div class="subTitulo">Livro / Folha / Termo</div>
        <div class="row row--registro">
          <div class="field">
            <label>Cartório (ofício)</label>
            <select data-bind="ui.cartorio_oficio" id="cartorio-oficio" class="w-cartorio">
              <option></option>
              <option value="6">6</option>
              <option value="9">9</option>
              <option value="12">12</option>
              <option value="13">13</option>
              <option value="14">14</option>
              <option value="15">15</option>
            </select>
          </div>
          <div class="field">
            <label>Livro</label>
            <input data-bind="ui.matricula_livro" name="livro" class="w-livro" placeholder="00000" inputmode="numeric" maxlength="5" />
          </div>
          <div class="field">
            <label>Folha</label>
            <input data-bind="ui.matricula_folha" name="folha" class="w-folha" placeholder="000" inputmode="numeric" maxlength="3" />
          </div>
          <div class="field">
            <label>Termo</label>
            <input data-bind="ui.matricula_termo" name="termo" class="w-termo" placeholder="0000000" inputmode="numeric" maxlength="7" onblur="this.dispatchEvent(new Event('change'))" />
          </div>
          <div class="field">
            <label>Matricula (gerada)</label>
            <input data-bind="registro.matricula" id="matricula" class="w-matricula" readonly />
          </div>
        </div>
      </div>
      <div class="section-divider"></div>
      <div class="section">
        <div class="subTitle">Assinante</div>
        <div class="grid">
          <div class="field span-6">
            <label>Assinante</label>
            <select name="idAssinante" data-signer-select></select>
          </div>
        </div>
      </div>
      <div class="section-divider"></div>
      <div class="section">
        <details class="collapse">
          <summary>Documentos adicionais</summary>
          <div class="grid">
          <div class="campo span-4">
            <label class="label">RG noivo</label>
            <input name="numeroRGNoivo" />
          </div>
          <div class="campo span-4">
            <label class="label">Data emissao RG noivo</label>
            <input name="dataExpedicaoRGNoivo" placeholder="DD/MM/AAAA" inputmode="tel" maxlength="10" autocomplete="off" data-date />
          </div>
          <div class="campo span-4">
            <label class="label">Orgao emissor RG noivo</label>
            <select name="idOrgaoExpedidorRGNoivo">
              <option value=""></option>
              <option>SSP</option>
              <option>PC</option>
              <option>DETRAN</option>
              <option>OUTRO</option>
            </select>
          </div>
          <div class="campo span-4">
            <label class="label">RG noiva</label>
            <input name="numeroRGNoiva" />
          </div>
          <div class="campo span-4">
            <label class="label">Data emissao RG noiva</label>
            <input name="dataExpedicaoRGNoiva" placeholder="DD/MM/AAAA" inputmode="tel" maxlength="10" autocomplete="off" data-date />
          </div>
          <div class="campo span-4">
            <label class="label">Orgao emissor RG noiva</label>
            <select name="idOrgaoExpedidorRGNoiva">
              <option value=""></option>
              <option>SSP</option>
              <option>PC</option>
              <option>DETRAN</option>
              <option>OUTRO</option>
            </select>
          </div>
          </div>
        </details>
      </div>
      </div>
      </div>
    </form>
      </div>
    </div>

    <div id="panel-inline"></div>

    <div class="ops-pane" id="ops-pane" aria-hidden="true">
      <div class="ops-header">
        <div class="ops-title">Operacoes</div>
        <button class="btn tiny secondary ops-close" type="button">Fechar</button>
      </div>
      <div class="ops-body">
        <div id="op-search" class="ops-panel">
          <div class="card">
            <div class="cardTitle">Busca</div>
            <div class="grid search-grid">
              <div class="field span-12">
                <label>Tipo</label>
                <div class="segmented">
                  <button type="button" class="seg-btn active" data-kind-toggle data-kind="">Todos</button>
                  <button type="button" class="seg-btn" data-kind-toggle data-kind="nascimento">Nascimento</button>
                  <button type="button" class="seg-btn" data-kind-toggle data-kind="casamento">Casamento</button>
                  <button type="button" class="seg-btn" data-kind-toggle data-kind="obito">Obito</button>
                </div>
                <input type="hidden" id="search-kind" value="" />
              </div>
              <div class="field span-12">
                <label>Busca livre</label>
                <input id="search-q" placeholder="Nome, CPF, matricula, municipio..." />
              </div>
              <div class="field span-6">
                <label>Nome</label>
                <input id="search-nome" />
              </div>
              <div class="field span-6">
                <label>Nome da mae</label>
                <input id="search-mae" />
              </div>
              <div class="field span-4">
                <label>CPF</label>
                <input id="search-cpf" inputmode="numeric" />
              </div>
              <div class="field span-4">
                <label>Termo</label>
                <input id="search-termo" inputmode="numeric" />
              </div>
            </div>
            <div class="toolbar-left" style="margin-top: 10px;">
              <button id="btn-search" class="btn secondary" type="button">Buscar</button>
            </div>
          </div>
          <div id="search-results" class="search-results"></div>
        </div>

        <div id="op-actions" class="ops-panel">
          <div class="card">
            <div class="cardTitle">Acoes</div>
            <div class="action-status">
              <div class="action-row">
                <span class="label">JSON em memoria</span>
                <span id="status-json" class="badge">—</span>
              </div>
              <div class="action-row">
                <span class="label">XML gerado</span>
                <span id="status-xml" class="badge">—</span>
              </div>
              <div class="action-row">
                <span class="label">PostgreSQL</span>
                <span id="status-db" class="badge">NAO</span>
              </div>
            </div>
            <div class="toolbar-left" style="margin-top: 10px;">
              <button id="actions-save" class="btn save" type="button">Salvar</button>
              <button id="actions-export-json" class="btn secondary" type="button">Exportar JSON</button>
              <button id="actions-export-xml" class="btn secondary" type="button">Baixar XML</button>
              <button id="actions-export-pdf" class="btn secondary" type="button">PDF</button>
            </div>
            <div class="action-hints">
              <span class="badge">Ctrl+Espaco: JSON</span>
              <span class="badge">Ctrl+Alt+P: PDF</span>
            </div>
            <div id="actions-status" class="import-status"></div>
          </div>
        </div>
      </div>
    </div>

  </div>

  <div id="drawer-slot"></div>

<script type="module" src="../js/casamento.bundle.js"></script>
  <script>
    (function(){
      try{
        const sel = document.getElementById('ato-select');
        if (!sel) return;
        sel.addEventListener('change', ()=>{
          try{
            const map = { nascimento: './Nascimento2Via.html', casamento: './Casamento2Via.html', obito: './Obito2Via.html' };
            const next = map[sel.value];
            if (next) {
              window.dispatchEvent(new CustomEvent('app:navigate', { detail: { href: next } }));
            }
          }catch(e){}
        });
      }catch(e){}
    })();
    (function(){
      try{
        const drawer = document.getElementById('drawer');
        if (!drawer) return;
        const tabbar = drawer.querySelector('.tabbar');
        if (!tabbar) return;
        const buttons = Array.from(tabbar.querySelectorAll('.tab-btn'));
        const panes = Array.from(drawer.querySelectorAll('.tab-pane'));
        const activate = (id) => {
          buttons.forEach((b) => b.classList.toggle('active', b.getAttribute('data-tab') === id));
          panes.forEach((p) => p.classList.toggle('active', p.getAttribute('id') === id));
        };
        tabbar.addEventListener('click', (e) => {
          const btn = e.target && e.target.closest ? e.target.closest('.tab-btn') : null;
          if (!btn) return;
          e.preventDefault();
          const id = btn.getAttribute('data-tab');
          if (id) activate(id);
        });
        const initial = (tabbar.querySelector('.tab-btn.active') || tabbar.querySelector('.tab-btn'));
        if (initial) activate(initial.getAttribute('data-tab'));

        const normalizeStatus = () => {
          const statusEl = document.getElementById('name-db-status');
          if (statusEl && statusEl.textContent) {
            statusEl.textContent = statusEl.textContent
              .replace(/disponível/g, 'disponível')
              .replace(/não/g, 'não')
              .replace(/padrão/g, 'padrão');
          }
        };
        normalizeStatus();
        setTimeout(normalizeStatus, 600);
        setTimeout(normalizeStatus, 1500);
      }catch(e){}
    })();
  </script>
</body>
</html>


