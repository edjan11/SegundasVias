<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>2 via casamento</title>
  <link rel="stylesheet" href="../styles/base.css" />
  <link rel="stylesheet" href="../styles/layout.css" />
  <link rel="stylesheet" href="../styles/components.css" />
</head>
<body class="page-casamento">
  <div class="container">
    <div class="toolbar">
      <div class="toolbar-left">
        <div class="app-title">2Âª Via de CertidÃ£o</div>
        <div class="ato-picker">
          <label class="label" for="ato-select">Ato</label>
          <select id="ato-select" class="ato-select">
            <option value="nascimento">Nascimento</option>
            <option value="casamento">Casamento</option>
            <option value="obito">Obito</option>
          </select>
        </div>
      </div>
      <div class="toolbar-right">
        <button id="drawer-toggle" class="btn secondary">Painel</button>
        <div style="display:inline-flex; gap:6px; align-items:center; margin-left:8px;">
          <button id="btn-json" class="btn json compact" title="Gerar JSON">JSON</button>
          <button id="btn-xml" class="btn xml compact" title="Exportar XML">XML</button>
          <button id="btn-print" class="btn pdf compact" title="Imprimir PDF">PDF</button>
        </div>
      </div>
    </div>

    <form id="form-casamento">
      <!-- Anti-autofill honeypot (consumes browser autofill) -->
      <div class="no-autofill-honeypot" aria-hidden="true">
        <input autocomplete="username" name="no_autofill_username" tabindex="-1" />
        <input type="password" autocomplete="new-password" name="no_autofill_password" tabindex="-1" />
        <input autocomplete="address-line1" name="no_autofill_addr1" tabindex="-1" />
        <input autocomplete="address-line2" name="no_autofill_addr2" tabindex="-1" />
        <input autocomplete="postal-code" name="no_autofill_postal" tabindex="-1" />
        <input autocomplete="country" name="no_autofill_country" tabindex="-1" />
      </div>
      <div class="card">
        <div class="section">
        <div class="subTitulo">Termo e casamento</div>
        <div class="grid">
          <div class="campo span-3">
            <label class="label">Data do termo <span class="obrigatorio">*</span></label>
            <input data-bind="registro.data_registro" name="dataTermo" placeholder="DD/MM/AAAA" inputmode="tel" maxlength="10" autocomplete="off" data-date data-required />
          </div>
          <div class="campo span-3">
            <label class="label">Data do casamento <span class="obrigatorio">*</span></label>
            <input name="dataCasamento" placeholder="DD/MM/AAAA" inputmode="tel" maxlength="10" autocomplete="off" data-date data-required />
          </div>
          <div class="campo span-3">
            <label class="label">Tipo de casamento <span class="obrigatorio">*</span></label>
            <select data-bind="ui.casamento_tipo" name="tipoCasamento" id="casamento-tipo-select" data-required>
              <option value=""></option>
              <option value="2">Civil</option>
              <option value="3">Religioso</option>
            </select>
          </div>
          <div class="campo span-3">
            <label class="label">Regime de bens</label>
            <select name="regimeBens">
              <option value=""></option>
              <option value="L">Separacao legal de bens</option>
              <option value="C">Separacao convencional de bens</option>
              <option value="B">Comunhao de bens</option>
              <option value="P">Comunhao parcial de bens</option>
              <option value="U">Comunhao universal de bens</option>
              <option value="A">Participacao final de bens nos aquestos</option>
              <option value="I">Ignorado</option>
            </select>
          </div>
          <!-- Livro/Folha/Termo moved to lower section under 2o nubente per layout request -->
        </div>
      </div>
      <div class="section-divider"></div>

      <div class="section">
        <div class="subTitulo">1o nubente (noivo)</div>
        <div class="grid">
          <div class="campo span-6">
            <label class="label">Nome atual <span class="obrigatorio">*</span></label>
            <input name="nomeSolteiro" data-name-validate data-required />
          </div>
          <div class="campo span-6">
            <label class="label">Nome apos casamento</label>
            <input name="nomeCasado" data-name-validate />
          </div>
          <div class="campo span-6">
            <label class="label">Nome do pai</label>
            <input name="nomePaiNoivo" data-name-validate />
          </div>
          <div class="campo span-6">
            <label class="label">Nome da mae</label>
            <input name="nomeMaeNoivo" data-name-validate />
          </div>
          <div class="campo span-3">
            <label class="label">Data de nascimento</label>
            <input name="dataNascimentoNoivo" placeholder="DD/MM/AAAA" inputmode="tel" maxlength="10" autocomplete="off" data-date />
          </div>
          <div class="campo span-6">
            <label class="label">Cidade nascimento</label>
            <input name="cidadeNascimentoNoivo" autocomplete="nope" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </div>
          <div class="campo span-3">
            <label class="label">UF nascimento</label>
            <select name="ufNascimentoNoivo" autocomplete="nope" spellcheck="false">
              <option value=""></option>
              <option>AC</option><option>AL</option><option>AP</option><option>AM</option><option>BA</option>
              <option>BR</option><option>CE</option><option>DF</option><option>ES</option><option>ET</option>
              <option>GO</option><option>IG</option><option>MA</option><option>MT</option><option>MS</option>
              <option>MG</option><option>PA</option><option>PB</option><option>PR</option><option>PE</option>
              <option>PI</option><option>RJ</option><option>RN</option><option>RS</option><option>RO</option>
              <option>RR</option><option>SC</option><option>SP</option><option>SE</option><option>TO</option>
            </select>
          </div>
          <div class="campo span-3">
            <label class="label">Nacionalidade</label>
            <input name="nacionalidadeNoivo" />
          </div>
          <div class="campo span-3">
            <label class="label">Estado civil</label>
            <select name="estadoCivilNoivo">
              <option value=""></option>
              <option value="SO">Solteiro(a)</option>
              <option value="CA">Casado(a)</option>
              <option value="DI">Divorciado(a)</option>
              <option value="VI">Viuvo(a)</option>
              <option value="SJ">Separado(a) judicialmente</option>
              <option value="DE">Desquitado(a)</option>
              <option value="IG">Ignorado</option>
            </select>
          </div>
          <div class="campo span-3">
            <label class="label">CPF</label>
            <input data-bind="registro.cpf_noivo" name="CPFNoivo" placeholder="000.000.000-00" inputmode="numeric" maxlength="14" autocomplete="off" data-cpf class="w-cpf" />
          </div>
        </div>
      </div>
      <div class="section-divider"></div>

      <div class="section">
        <div class="subTitulo">2o nubente (noiva)</div>
        <div class="grid">
          <div class="campo span-6">
            <label class="label">Nome atual <span class="obrigatorio">*</span></label>
            <input name="nomeSolteira" data-name-validate data-required />
          </div>
          <div class="campo span-6">
            <label class="label">Nome apos casamento</label>
            <input name="nomeCasada" data-name-validate />
          </div>
          <div class="campo span-6">
            <label class="label">Nome do pai</label>
            <input name="nomePaiNoiva" data-name-validate />
          </div>
          <div class="campo span-6">
            <label class="label">Nome da mae</label>
            <input name="nomeMaeNoiva" data-name-validate />
          </div>
          <div class="campo span-3">
            <label class="label">Data de nascimento</label>
            <input name="dataNascimentoNoiva" placeholder="DD/MM/AAAA" inputmode="tel" maxlength="10" autocomplete="off" data-date />
          </div>
          <div class="campo span-6">
            <label class="label">Cidade nascimento</label>
            <input name="cidadeNascimentoNoiva" autocomplete="nope" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </div>
          <div class="campo span-3">
            <label class="label">UF nascimento</label>
            <select name="ufNascimentoNoiva" autocomplete="nope" spellcheck="false">
              <option value=""></option>
              <option>AC</option><option>AL</option><option>AP</option><option>AM</option><option>BA</option>
              <option>BR</option><option>CE</option><option>DF</option><option>ES</option><option>ET</option>
              <option>GO</option><option>IG</option><option>MA</option><option>MT</option><option>MS</option>
              <option>MG</option><option>PA</option><option>PB</option><option>PR</option><option>PE</option>
              <option>PI</option><option>RJ</option><option>RN</option><option>RS</option><option>RO</option>
              <option>RR</option><option>SC</option><option>SP</option><option>SE</option><option>TO</option>
            </select>
          </div>
          <div class="campo span-3">
            <label class="label">Nacionalidade</label>
            <input name="nacionalidadeNoiva" />
          </div>
          <div class="campo span-3">
            <label class="label">Estado civil</label>
            <select name="estadoCivilNoiva">
              <option value=""></option>
              <option value="SO">Solteiro(a)</option>
              <option value="CA">Casado(a)</option>
              <option value="DI">Divorciado(a)</option>
              <option value="VI">Viuvo(a)</option>
              <option value="SJ">Separado(a) judicialmente</option>
              <option value="DE">Desquitado(a)</option>
              <option value="IG">Ignorado</option>
            </select>
          </div>
          <div class="campo span-3">
            <label class="label">CPF</label>
            <input data-bind="registro.cpf_noiva" name="CPFNoiva" placeholder="000.000.000-00" inputmode="numeric" maxlength="14" autocomplete="off" data-cpf class="w-cpf" />
          </div>
        </div>
      </div>
      <div class="section-divider"></div>

      <div class="section">
        <div class="subTitulo">Observacoes</div>
        <div class="campo">
          <label class="label">Observacao</label>
          <textarea name="observacao" rows="4"></textarea>
        </div>
      </div>
      <div class="section-divider"></div>
        <div class="section">
        <div class="subTitulo">Livro / Folha / Termo</div>
        <div class="grid">
          <div class="campo span-3">
            <label class="label">CartÃ³rio (ofÃ­cio)</label>
            <select data-bind="ui.cartorio_oficio" id="cartorio-oficio" class="w-cartorio">
              <option></option>
              <option value="6">6</option>
              <option value="9">9</option>
              <option value="12">12</option>
              <option value="13">13</option>
              <option value="14">14</option>
              <option value="15">15</option>
            </select>
          </div>
          <div class="campo span-3">
            <label class="label">Livro</label>
            <input data-bind="ui.matricula_livro" name="livro" inputmode="numeric" maxlength="5" />
          </div>
          <div class="campo span-3">
            <label class="label">Folha</label>
            <input data-bind="ui.matricula_folha" name="folha" inputmode="numeric" maxlength="3" />
          </div>
          <div class="campo span-3">
            <label class="label">Termo</label>
            <input data-bind="ui.matricula_termo" name="termo" inputmode="numeric" maxlength="7" onblur="this.dispatchEvent(new Event('change'))" />
          </div>
          <div class="campo span-6">
            <label class="label">Matricula (gerada)</label>
            <input id="matricula" data-bind="registro.matricula" readonly />
          </div>
        </div>
      </div>
      <div class="section-divider"></div>
      <div class="section">
        <div class="subTitle">Assinante</div>
        <div class="grid">
          <div class="field span-6">
            <label>Assinante</label>
            <select name="idAssinante" data-signer-select></select>
          </div>
        </div>
      </div>
      <div class="section-divider"></div>
      <div class="section">
        <details class="collapse">
          <summary>Documentos adicionais</summary>
          <div class="grid">
          <div class="campo span-4">
            <label class="label">RG noivo</label>
            <input name="numeroRGNoivo" />
          </div>
          <div class="campo span-4">
            <label class="label">Data emissao RG noivo</label>
            <input name="dataExpedicaoRGNoivo" placeholder="DD/MM/AAAA" inputmode="tel" maxlength="10" autocomplete="off" data-date />
          </div>
          <div class="campo span-4">
            <label class="label">Orgao emissor RG noivo</label>
            <select name="idOrgaoExpedidorRGNoivo">
              <option value=""></option>
              <option>SSP</option>
              <option>PC</option>
              <option>DETRAN</option>
              <option>OUTRO</option>
            </select>
          </div>
          <div class="campo span-4">
            <label class="label">RG noiva</label>
            <input name="numeroRGNoiva" />
          </div>
          <div class="campo span-4">
            <label class="label">Data emissao RG noiva</label>
            <input name="dataExpedicaoRGNoiva" placeholder="DD/MM/AAAA" inputmode="tel" maxlength="10" autocomplete="off" data-date />
          </div>
          <div class="campo span-4">
            <label class="label">Orgao emissor RG noiva</label>
            <select name="idOrgaoExpedidorRGNoiva">
              <option value=""></option>
              <option>SSP</option>
              <option>PC</option>
              <option>DETRAN</option>
              <option>OUTRO</option>
            </select>
          </div>
          </div>
        </details>
      </div>
      </div>
      </div>
    </form>
  </div>

  <div id="panel-inline"></div>

  <div id="drawer" class="drawer">
    <div class="drawer-header">
      <div class="drawer-title">Painel</div>
      <button id="drawer-close" class="btn tiny secondary" type="button">Fechar</button>
    </div>
        <div class="drawer-body">
      <div class="tabbar">
        <button class="tab-btn active" data-tab="tab-config">Configuracoes</button>
        <button class="tab-btn" data-tab="tab-json">JSON</button>
        <button class="tab-btn" data-tab="tab-xml">XML</button>
        <button class="tab-btn" data-tab="tab-admin">Administracao</button>
        <button class="tab-btn" data-tab="tab-debug">Debug</button>
      </div>

      <div id="tab-config" class="tab-pane active">
        <div id="name-db-status" style="display:none;"></div>

        <div class="card">
          <div class="cardTitle">Settings</div>
          <div class="grid">
            <div class="field span-12">
              <label>Exibir painel inline</label>
              <div class="field-line">
                <label class="inline-check"><input type="checkbox" id="settings-panel-inline" /> Exibir inline (se desmarcado, painel flutuante sera usado)</label>
              </div>
            </div>
            <div class="field span-6">
              <label>Posicionamento do painel (nao usado em modo inline)</label>
              <select id="settings-drawer-position" class="campo">
                <option value="bottom-right">Inferior direito</option>
                <option value="top">Topo central</option>
                <option value="side">Lateral</option>
              </select>
            </div>
            <div class="field span-6">
              <label>Preferencias</label>
              <div class="field-line">
                <label class="inline-check"><input type="checkbox" id="settings-enable-cpf" /> Validar CPF</label>
                <label class="inline-check"><input type="checkbox" id="settings-enable-name" /> Validar Nomes</label>
              </div>
            </div>
            <div class="field span-6">
              <label>Layout</label>
              <div class="field-line">
                <label class="inline-check"><input type="checkbox" id="settings-fixed-layout" /> Layout fixo (nao quebrar no zoom)</label>
              </div>
              <div class="field-line" style="margin-top:4px;">
                <label class="inline-check">Zoom interno</label>
                <input type="range" id="settings-zoom" min="80" max="110" step="1" />
                <span id="settings-zoom-value">100%</span>
              </div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="cardTitle">Pastas</div>
          <div class="grid">
            <div class="field span-9">
              <label>Pasta JSON</label>
              <input id="json-dir" readonly />
            </div>
            <div class="field span-3">
              <label>&nbsp;</label>
              <button id="pick-json" class="btn secondary" type="button">Selecionar...</button>
            </div>
            <div class="field span-9">
              <label>Pasta XML</label>
              <input id="xml-dir" readonly />
            </div>
            <div class="field span-3">
              <label>&nbsp;</label>
              <button id="pick-xml" class="btn secondary" type="button">Selecionar...</button>
            </div>
            <div class="field span-12">
              <span id="outputDirBadge" class="badge">JSON: ... | XML: ...</span>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="cardTitle">Certidao</div>
          <div class="grid">
            <div class="field span-3">
              <label>plataformaId</label>
              <input name="certidao.plataformaId" />
            </div>
            <div class="field span-3">
              <label>tipo_registro</label>
              <input data-bind="certidao.tipo_registro" name="certidao.tipo_registro" value="casamento" readonly />
            </div>
            <div class="field span-3">
              <label>tipo_certidao</label>
              <select name="certidao.tipo_certidao">
                <option></option><option>Breve relato</option><option>Inteiro teor</option>
              </select>
            </div>
            <div class="field span-3">
              <label>modalidade</label>
              <select name="certidao.modalidade">
                <option></option><option>eletronica</option><option>fisica</option>
              </select>
            </div>
            <div class="field span-3">
              <label>cartorio_cns</label>
              <input name="certidao.cartorio_cns" />
            </div>
            <div class="field span-3">
              <label>selo</label>
              <input name="certidao.selo" />
            </div>
            <div class="field span-3">
              <label>cod_selo</label>
              <input name="certidao.cod_selo" />
            </div>
            <div class="field span-3">
              <label>cota_emolumentos</label>
              <input name="certidao.cota_emolumentos" />
            </div>
            <div class="field checkboxField span-2">
              <input type="checkbox" name="certidao.transcricao" />
              <label>transcricao</label>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="cardTitle">Automacoes</div>
          <div class="grid">
            <div class="field span-12">
              <label>Corretor de nome</label>
              <div class="field-line">
                <label class="inline-check">
                  <input type="radio" name="name-validation-mode" value="blur" />
                  Somente ao sair do input
                </label>
                <label class="inline-check">
                  <input type="radio" name="name-validation-mode" value="input" />
                  Durante a digitacao
                </label>
              </div>
            </div>
          </div>
          <div class="toolbar-left" style="margin-top: 10px;">
            <button id="config-save" class="btn" type="button">Salvar configuracao</button>
          </div>
        </div>

        <div style="margin-top:10px;" class="toolbar-left">
          <button id="settings-save" class="btn" type="button">Salvar</button>
          <button id="settings-apply" class="btn secondary" type="button">Aplicar sem salvar</button>
        </div>
      </div>

      <div id="tab-json" class="tab-pane">
        <div class="field">
          <label>JSON</label>
          <textarea id="json-output" rows="10" readonly></textarea>
        </div>
        <button id="btn-json" type="button" class="btn json compact">JSON</button>
      </div>

      <div id="tab-xml" class="tab-pane">
        <div class="field">
          <label>XML</label>
          <textarea id="xml-output" rows="10" readonly></textarea>
        </div>
        <button id="btn-xml" type="button" class="btn xml compact">XML</button>
      </div>

      <div id="tab-admin" class="tab-pane">
        <div class="card">
          <div class="cardTitle">Administracao</div>
          <div class="grid">
            <div class="field span-9">
              <label>Assinante</label>
              <input id="admin-signer-name" placeholder="Nome do assinante" />
            </div>
            <div class="field span-3">
              <label>&nbsp;</label>
              <button id="admin-signer-add" class="btn secondary" type="button">Adicionar</button>
            </div>
            <div class="field span-12">
              <div id="admin-signer-list"></div>
            </div>
          </div>
        </div>
      </div>

      <div id="tab-debug" class="tab-pane">
        <div class="grid">
          <div class="field span-8">
            <label>Base matricula</label>
            <input id="debug-matricula-base" readonly />
          </div>
          <div class="field span-2">
            <label>DV</label>
            <input id="debug-matricula-dv" readonly />
          </div>
          <div class="field span-2">
            <label>Final</label>
            <input id="debug-matricula-final" readonly />
          </div>
          <div class="field span-12">
            <label>Campos invalidos</label>
            <textarea id="debug-invalid" rows="3" readonly></textarea>
          </div>
          <div class="field span-12">
            <label>Alertas</label>
            <textarea id="debug-alerts" rows="3" readonly></textarea>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script type="module" src="../js/casamento.bundle.js"></script>
  <script>
    (function(){
      try{
        const sel = document.getElementById('ato-select');
        if (!sel) return;
        sel.addEventListener('change', ()=>{
          try{
            const map = { nascimento: './Nascimento2Via.html', casamento: './Casamento2Via.html', obito: './Obito2Via.html' };
            const next = map[sel.value];
            if (next) {
              window.dispatchEvent(new CustomEvent('app:navigate', { detail: { href: next } }));
            }
          }catch(e){}
        });
      }catch(e){}
    })();
    (function(){
      try{
        const drawer = document.getElementById('drawer');
        if (!drawer) return;
        const tabbar = drawer.querySelector('.tabbar');
        if (!tabbar) return;
        const buttons = Array.from(tabbar.querySelectorAll('.tab-btn'));
        const panes = Array.from(drawer.querySelectorAll('.tab-pane'));
        const activate = (id) => {
          buttons.forEach((b) => b.classList.toggle('active', b.getAttribute('data-tab') === id));
          panes.forEach((p) => p.classList.toggle('active', p.getAttribute('id') === id));
        };
        tabbar.addEventListener('click', (e) => {
          const btn = e.target && e.target.closest ? e.target.closest('.tab-btn') : null;
          if (!btn) return;
          e.preventDefault();
          const id = btn.getAttribute('data-tab');
          if (id) activate(id);
        });
        const initial = (tabbar.querySelector('.tab-btn.active') || tabbar.querySelector('.tab-btn'));
        if (initial) activate(initial.getAttribute('data-tab'));

        const normalizeStatus = () => {
          const statusEl = document.getElementById('name-db-status');
          if (statusEl && statusEl.textContent) {
            statusEl.textContent = statusEl.textContent
              .replace(/disponÃ­vel/g, 'disponível')
              .replace(/nÃ£o/g, 'não')
              .replace(/padrÃ£o/g, 'padrão');
          }
        };
        normalizeStatus();
        setTimeout(normalizeStatus, 600);
        setTimeout(normalizeStatus, 1500);
      }catch(e){}
    })();
  </script>
</body>
</html>

